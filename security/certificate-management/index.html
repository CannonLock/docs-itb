<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Certificate Management Reference - OSG ITB Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/itb.css" rel="stylesheet">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Certificate Management Reference";
    var mkdocs_page_input_path = "security/certificate-management.md";
    var mkdocs_page_url = "/security/certificate-management/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG ITB Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
  
    <a class="" href="../..">Home</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  
    <a class="" href="../../site-planning/">Site Planning</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Compute Element</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../compute-element/htcondor-ce-overview/">HTCondor-CE Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/install-htcondor-ce/">Install HTCondor-CE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/job-router-recipes/">Job Router Recipes</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/troubleshoot-htcondor-ce/">Troubleshooting HTCondor-CE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/submit-htcondor-ce/">Submitting to HTCondor-CE</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Worker Node</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../worker-node/using-wn/">Worker Node Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn/">Worker Node (RPM install)</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn-tarball/">Worker Node (tarball install)</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn-oasis/">Worker Node (OASIS install)</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-cvmfs/">CVMFS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-singularity/">Singularity</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Data</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/frontier-squid/">Install HTTP Cache</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/update-oasis/">Update OASIS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/external-oasis-repos/">External OASIS repositories</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/gridftp/">Install GridFTP Server</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/load-balanced-gridftp/">Install Load Balanced GridFTP</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-gridftp-xrootd/">Install GridFtp XRootD</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/hadoop-overview/">Hadoop Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-hadoop-2-0-0/">Hadoop</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/xrootd-overview/">XRootD Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-xroot-client/">Install XRootD Client</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-xrootd/">Install XRootD</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Security</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../lcmaps-voms-authentication/">LCMAPS-VOMS authentication</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../host-certs/">Host Certificates</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../user-certs/">User Certificates</a>
  
        </li>
        <li class=" current">
          
  
    <a class="current" href="./">Certificate Management Reference</a>
  
  <ul class="subnav">
      
    <li class="toctree-l3"><a href="#managing-certificates">Managing Certificates</a></li>
    

    <li class="toctree-l3"><a href="#osg-pki-command-line-clients">OSG PKI Command Line Clients</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l4" href="#prerequisites">Prerequisites</a></li>
        
            <li><a class="toctree-l4" href="#installation">Installation</a></li>
        
            <li><a class="toctree-l4" href="#usage">Usage</a></li>
        
            <li><a class="toctree-l4" href="#test-mode">Test Mode</a></li>
        
            <li><a class="toctree-l4" href="#current-limitations-and-bugs">Current Limitations and Bugs</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#osg-ca-certificates-updater">OSG CA Certificates Updater</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#requirements">Requirements</a></li>
        
            <li><a class="toctree-l4" href="#install-instructions">Install instructions</a></li>
        
            <li><a class="toctree-l4" href="#services">Services</a></li>
        
            <li><a class="toctree-l4" href="#configuration">Configuration</a></li>
        
            <li><a class="toctree-l4" href="#troubleshooting">Troubleshooting</a></li>
        
            <li><a class="toctree-l4" href="#references">References</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#managing-cas">Managing CAs</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#syntax">Syntax</a></li>
        
            <li><a class="toctree-l4" href="#troubleshooting_1">Troubleshooting</a></li>
        
            <li><a class="toctree-l4" href="#references_1">References</a></li>
        
        </ul>
    

  </ul>
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Common</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../common/install-best-practices/">Install Best Practices</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/ca/">CA Certificates</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/yum/">Yum Repos</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/openjdk7/">Java 7</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/configuration-with-osg-configure/">Configuration with OSG-Configure</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Other</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../other/gsissh/">GSI-enabled SSH</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/install-gwms-frontend/">GlideinWMS Frontend</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/install-cvmfs-stratum1/">Install a CVMFS Stratum 1</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/network-performance-toolkit/">Network Performance Toolkit</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Release Information</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../release/notes/">Release Notes</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/release_series/">OSG Release Series</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/supported_platforms/">Supported Platforms</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/install-osg-upcoming-software/">OSG upcoming software</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/yum-basics/">Yum Basics</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/signing/">RPM Signing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/contrib/">Contrib Software</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Monitoring</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../monitoring/install-rsv/">Install RSV</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/advanced-rsv-configuration/">Advanced RSV Configuration</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/rsv-control/">Manage RSV via rsv-control</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/install-rsv-gwms-tester/">RSV GlideinWMS Tester</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Deprecated Software</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/bestman-install/">BeStMan Install</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-bestman-xrootd/">BeStMan Xrootd SE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../edg-mkgridmap/">EDG-Mkgridmap Install</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../install-gums/">GUMS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-glexec/">Worker node glexec Install</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../other/install-voms/">Install VOMS</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  
    <a class="" href="../../common/help/">Get Help</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG ITB Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Security &raquo;</li>
        
      
    
    <li>Certificate Management Reference</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/docs-itb/edit/master/docs/security/certificate-management.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="managing-certificates">Managing Certificates<a class="headerlink" href="#managing-certificates" title="Permanent link">&para;</a></h1>
<p>The OSG provides several tools to assist in the management of host and CA certificates.  This page serves as a
reference guide for several of these tools:</p>
<ul>
<li><code>osg-pki-tools</code>: command line tools for requesting and managing user and host certificates.</li>
<li><code>osg-ca-certs-updater</code>: A package for auto-updating CAs on a server host.</li>
<li><code>osg-ca-manage</code>: A tool for detailed management of CA directories outside RPMs.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a reference document and not introduction on how to install CA certificates or request
host / user certificates.  Most users will want the <a href="../../common/ca/">CA overview</a>,
<a href="../host-certs/">host certificate overview</a>, or <a href="../user-certs/">user certificate overview</a> documents.</p>
</div>
<h1 id="osg-pki-command-line-clients">OSG PKI Command Line Clients<a class="headerlink" href="#osg-pki-command-line-clients" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The OSG PKI Command Line Clients provide a command-line interface for requesting and issuing host certificates from the OSG PKI. They complement the <a href="https://oim.opensciencegrid.org/oim/certificateuser">OIM Web Interface</a>.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>If you have not already done so, you need to <a href="../../common/yum/">configure the OSG software repositories</a>.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>The command-line scripts have been packaged as an RPM and are available from the OSG repositories.</p>
<p>To install the RPM, run:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> yum install osg-pki-tools
</pre></div>


<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<h3 id="configuration-files">Configuration Files<a class="headerlink" href="#configuration-files" title="Permanent link">&para;</a></h3>
<p>This configuration file contains information divided into two sections for testing and production.  Configuration variables include:</p>
<ul>
<li>Request URL</li>
<li>Approve URL</li>
<li>Retrieve URL</li>
<li>Host URL</li>
</ul>
<p>These parameters are used as input to the script depending upon the mode of execution of the script (test or OIM). The command-line utilities check for configuration files in the following order:</p>
<ul>
<li><code>$HOME/.osg-pki/OSG_PKI.ini</code></li>
<li><code>./pki-clients.ini</code></li>
<li><code>/etc/pki-clients.ini</code></li>
</ul>
<h3 id="osg-cert-request">osg-cert-request<a class="headerlink" href="#osg-cert-request" title="Permanent link">&para;</a></h3>
<p>Sends a request for a host certificate.</p>
<p>This script generates a private key and submits a request for a certificate to the OSG PKI. The request will be approved by an appropriate Grid Admin. You will receive an email when this approval has been completed containing directions on how to run <code>osg-cert-retreive</code> to retrieve the certificate. It works in two modes:</p>
<ul>
<li>CSR is provided by the user: the CSR provided is sent to the OIM.</li>
<li>CSR is not provided by the user: the script generates a private key for the user. Writes it to default key file name or the one specified by <code>-o</code>.</li>
</ul>
<p>This script:</p>
<ul>
<li>Generates a new host private key and CSR (the only important part of CSR is <code>CN=&lt;HOSTNAME&gt;</code> component).</li>
<li>Saves the host private key to disk (as specified by the user).</li>
<li>Authenticates to OIM and posts the CSR as a request to OIM.</li>
<li>Returns the request ID to the user.</li>
</ul>
<p>If the user provides the CSR, then this script would just send the same CSR to OIM.</p>
<p><strong>Inputs:</strong></p>
<ul>
<li>fully-qualified hostname</li>
<li>filename to store private key (optional; default is <code>./hostkey.pem</code>).</li>
<li>path to user's certificate (optional: default is path specified by <code>$X509_USER_CERT</code> environment variable, then <code>~/.globus/usercert.pem</code>).</li>
<li>path to user's private key (optional: default is path specified by <code>$X509_USER_KEY</code> environment variable, then <code>~/.globus/userkey.pem</code>).</li>
<li>Passphrase for user's private key (via non-echoing prompt).</li>
<li>User needs to provide VO name if the requested hostname has multiple VO's assigned.</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Private key, to filename specified by <code>-o</code> or <code>./hostkey.pem</code> by default.</li>
<li>Request Id, to <code>stdout</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-request --help
<span class="go">Usage: osg-cert-request [options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -c CSR, --csr=CSR     Specify CSR name (default = gennew.csr)</span>
<span class="go">  -o OUTPUT KEYFILE, --outkeyfile=OUTPUT KEYFILE</span>
<span class="go">                        Specify the output filename for the retrieved user certificate.</span>
<span class="go">                        Default is ./hostkey.pem</span>
<span class="go">  -v VO name, --vo=VO name</span>
<span class="go">                        Specify the VO for the host request</span>
<span class="go">  -y CC LIST, --cc=CC LIST</span>
<span class="go">                        Specify the CC list(the email id&#39;s to be CCed).</span>
<span class="go">                        Separate values by &#39;,&#39;</span>
<span class="go">  -m COMMENT, --comment=COMMENT</span>
<span class="go">                        The comment to be added to the request</span>
<span class="go">  -H CN, --hostname=CN  Specify a hostname for CSR (FQDN)</span>
<span class="go">  -a HOSTNAME, --altname=HOSTNAME</span>
<span class="go">                        Specify an alternative hostname for the CSR (FQDN). May be used more than once</span>
<span class="go">  -e EMAIL, --email=EMAIL</span>
<span class="go">                        Email address to receive certificate</span>
<span class="go">  -n NAME, --name=NAME  Name of user receiving certificate</span>
<span class="go">  -p PHONE, --phone=PHONE</span>
<span class="go">                        Phone number of user receiving certificate</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -d WRITE_DIRECTORY, --directory=WRITE_DIRECTORY</span>
<span class="go">                        Write the output files to this directory</span>
<span class="go">  -V, --version         Print version information and exit</span>
</pre></div>


<h4 id="examples">Examples.<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h4>
<p>OSG generates the key pair for the request.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-request -t hostname.domain.com -e emailaddress@domain.com -n <span class="s2">&quot;Your Name&quot;</span> -p <span class="m">9999999999</span> -y <span class="s2">&quot;xyz@domain.com,abc@domain.com&quot;</span> -m <span class="s2">&quot;This is my comment&quot;</span>
</pre></div>


<p>If you want to request a service certificate, you need to escape backslash for service name inside CN like following.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-request -t hostname.domain.com -e emailaddress@domain.com -n <span class="s2">&quot;Your Name&quot;</span> -p <span class="m">9999999999</span> -y <span class="s2">&quot;rsv\/xyz@domain.com&quot;</span> -m <span class="s2">&quot;This is my comment&quot;</span>
</pre></div>


<p>You can create your CSR on your target hosts using tools such as <code>openssl</code>.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> <span class="nb">umask</span> <span class="m">077</span><span class="p">;</span> openssl req -new -newkey rsa:2048 -nodes -keyout hostkey.pem -subj <span class="s2">&quot;/CN=osg-ce.example.edu&quot;</span> -out csr.pem
</pre></div>


<p>Note that the DN will be overriden by the OSG PKI except for the CN component.</p>
<p>Submitting the request:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-request -t hostname.domain.com -e emailaddress@domain.com -n <span class="s2">&quot;Your Name&quot;</span> -p <span class="m">9999999999</span> -y <span class="s2">&quot;xyz@domain.com,abc@domain.com&quot;</span> -m <span class="s2">&quot;This is my comment&quot;</span> --csr csr.pem
</pre></div>


<h3 id="osg-cert-retrieve">osg-cert-retrieve<a class="headerlink" href="#osg-cert-retrieve" title="Permanent link">&para;</a></h3>
<p>Retrieve a certificate (host or user) from OIM given a request Id. Typically you will run this script after submitting a request with <code>osg-cert-request</code> and receiving an email telling you your certificate has been approved.</p>
<p>You can also use this script to retrieve other certificates that have been previously issued (assuming you know their request ID number).</p>
<p>Since certificates are public, no authentication of the user is required.</p>
<p>This script:</p>
<ul>
<li>Accepts a request Id from the user</li>
<li>Connects to OIM and requests the certificate identified by the request ID</li>
<li>Writes the certificate to disk (as specified by the user)</li>
</ul>
<p><strong>Inputs:</strong></p>
<ul>
<li>Request ID</li>
<li>Filename to store certificate (optional: default is <code>./hostcert.pem</code>).</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Host certificate as PEM, to filename specified or <code>./hostcert.pem</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-retrieve --help
<span class="go">Usage: osg-cert-retrieve [options] &lt;Request ID&gt;</span>
<span class="go">Usage: osg-cert-retrieve -h/--help [for detailed explanations of options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -o ID, --certfile=ID  Specify the output filename for the retrieved user</span>
<span class="go">                        certificate . Default is ./hostcert.pem</span>
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -d WRITE_DIRECTORY, --directory=WRITE_DIRECTORY</span>
<span class="go">                        Write the output files to this directory</span>
<span class="go">  -V, --version         Print version information and exit</span>
<span class="go">  -i, --id              Specify ID# of certificate to be retrieved</span>
<span class="go">                        [deprecated]</span>
</pre></div>


<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-retrieve -i <span class="m">555</span>
</pre></div>


<h3 id="osg-gridadmin-cert-request">osg-gridadmin-cert-request<a class="headerlink" href="#osg-gridadmin-cert-request" title="Permanent link">&para;</a></h3>
<p>Request and retrieve multliple host certificates from OIM. Authenticates to OIM and is only for use by Grid Admins for certificates they are authorized to approve. This script is only supported with all hosts being in the same domain (so we ensure they go to the same Grid Admin). The certificates are stored with the format of <code>hostname-requestid.pem</code> (i.e. the id generated from the request for the certificate). The key is stored as <code>hostname-serial-key.pem</code>.</p>
<p>This script does the following in the process of acquiring certificates for the hostnames specified:</p>
<ul>
<li>Reads a list of fully-qualified hostnames from a file specified by the user.</li>
<li>For each hostname:<ul>
<li>Generates a new private key and CSR.</li>
<li>Only important part of CSR is <code>CN=&lt;HOSTNAME&gt;</code> component.</li>
<li>Writes the private key to a file with filename: <code>&lt;PREFIX&gt;/&lt;HOSTNAME&gt;-key.pem</code>.</li>
<li>Prompts the user for their private key pass phrase (the pass phrase is cached so user is not re-prompted).</li>
<li>Authenticates to OIM and posts the CSRs as a single request to OIM.</li>
<li>Request ID is returned and subsequently used.</li>
<li>Authenticates to OIM and approves the request.</li>
<li>Waits one minute for request to be processed by OIM.</li>
<li>Connects to OIM and attempts to retrieve certificates.</li>
<li>Writes out any certificates it retrieves with filename of <code>&lt;PREFIX&gt;/&lt;HOSTNAME&gt;-&lt;ID&gt;.pem</code>.</li>
<li>If all certificates have been retrieved, exits loop.</li>
<li>Wait 5 seconds and proceeds with the next repeat.</li>
</ul>
</li>
</ul>
<p><strong>Inputs:</strong></p>
<ul>
<li>filename of list of hostnames.</li>
<li>prefix path in which to write private keys and certificates (default: <code>.</code>.)</li>
<li>path to user's certificate (optional: default is path specified by <code>$X509_USER_CERT</code> environment variable, then <code>~/.globus/usercert.pem</code>).</li>
<li>path to user's private key (optional, default is path specified by <code>$X509_USER_KEY</code> environment variable, then <code>~/.globus/userkey.pem</code>).</li>
<li>Passphrase for user's private key via non-echoing prompt.</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li><code>N</code> host certificates in PEM format.</li>
<li><code>N</code> private keys in PEM format.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-gridadmin-cert-request --help
<span class="go">Usage: osg-gridadmin-cert-request [options] arg</span>
<span class="go">Usage: osg-gridadmin-cert-request -h/--help [for detailed explanations of options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -k PKEY, --pkey=PKEY  Specify Requestor&#39;s private key (PEM Format). If not</span>
<span class="go">                        specifiedwill take the value of X509_USER_KEY or</span>
<span class="gp">                        $</span>HOME/.globus/userkey.pem
<span class="go">  -c CERT, --cert=CERT  Specify Requestor&#39;s certificate (PEM Format). If not</span>
<span class="go">                        specified, will take the value of X509_USER_CERT or</span>
<span class="gp">                        $</span>HOME/.globus/usercert.pem
<span class="go">  -a HOSTNAME, --altname=HOSTNAME</span>
<span class="go">                        Specify an alternative hostname for CSR (FQDN). May be</span>
<span class="go">                        used more than once and if specified, -f/--hostfile</span>
<span class="go">                        will be ignored</span>
<span class="go">  -v VO name, --vo=VO name</span>
<span class="go">                        Specify the VO for the host request</span>
<span class="go">  -y CC List, --cc=CC List</span>
<span class="go">                        Specify the CC list(the email id&#39;s to be</span>
<span class="go">                        CCed).Separate values by &#39;,&#39;</span>
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -d WRITE_DIRECTORY, --directory=WRITE_DIRECTORY</span>
<span class="go">                        Write the output files to this directory</span>
<span class="go">  -V, --version         Print version information and exit</span>

<span class="go">  Hostname Options:</span>
<span class="go">    Use either of these options. Specify hostname as a single hostname</span>
<span class="go">    using -H/--hostname or specify from a file using -f/--hostfile.</span>

<span class="go">    -H HOSTNAME, --hostname=HOSTNAME</span>
<span class="go">                        Specify the hostname or service/hostname for which you</span>
<span class="go">                        want to request the certificate for. If specified,</span>
<span class="go">                        -f/--hostfile will be ignored</span>
<span class="go">    -f HOSTFILE, --hostfile=HOSTFILE</span>
<span class="go">                        Filename with one host (hostname or service/hostname</span>
<span class="go">                        and its optional,alternative hostnames, separated by</span>
<span class="go">                        spaces) per line</span>
</pre></div>


<p>Examples:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-gridadmin-cert-request -f filename -k privatekeyfile -c certificatefile
</pre></div>


<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-gridadmin-cert-request -H hostname.domain.com -k privatekeyfile -c certificatefile
</pre></div>


<h3 id="osg-user-cert-renew">osg-user-cert-renew<a class="headerlink" href="#osg-user-cert-renew" title="Permanent link">&para;</a></h3>
<p>Sends a request for renewing a user certificate and if the certificate can be renewed, fetches and writes the renewed certificate.</p>
<p>The script generates request for renewing user certificate to the OIM, and if the certificate is renewed, it fetches the renewed user certificate. The user is authenticated before making such a request. If the user certificate is renewed, the user gets email notification regarding the same and the renewed certificate is saved by the name of the existing certificate suffixed by <code>-renewed.pem</code> (e.g. when we renew <code>my-cert.pem</code>, the renewed certificate is named <code>my-cert-renewed.pem</code>).</p>
<p><strong>Inputs:</strong></p>
<ul>
<li>path to user's certificate (optional: default is path specified by <code>$X509_USER_CERT</code> environment variable, then <code>~/.globus/usercert.pem</code>).</li>
<li>path to user's private key (optional: default is path specified by <code>$X509_USER_KEY</code> environment variable, then <code>~/.globus/userkey.pem</code>).</li>
<li>Passphrase for user's private key via non-echoing prompt.</li>
<li>User needs to provide VO name if the requested hostname has multiple VO's assigned</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>On Renewal, the renewed certificate is stored with the filename of the older user certificate suffixed with <code>-renewed.pem</code>.  The certificate name for renewed certificate is sent to <code>stdout</code>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the retrieval of user certificate fails for some reason, the user can download the renewed certificate from OIM web interface using the following URL (where <code>&lt;REQID&gt;</code> is the request ID number for the user certificate on OIM):</p>
<div class="codehilite"><pre><span></span>https://oim.opensciencegrid.org/oim/certificateuser?id=&lt;REQID&gt;
</pre></div>


</div>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-user-cert-renew --help
<span class="go">Usage: osg-user-cert-renew [options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -k PKEY, --pkey=PKEY  Specify Requestor&#39;s private key (PEM Format). If not</span>
<span class="go">                        specified  will take the value of X509_USER_KEY or</span>
<span class="gp">                        $</span>HOME/.globus/userkey.pem
<span class="go">  -c CERT, --cert=CERT  Specify Requestor&#39;s certificate (PEM Format).  If not</span>
<span class="go">                        specified will take the value of X509_USER_CERT or</span>
<span class="gp">                        $</span>HOME/.globus/usercert.pem
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -d WRITE_DIRECTORY, --directory=WRITE_DIRECTORY</span>
<span class="go">                        Write the output files to this directory</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -V, --version         Print version information and exit</span>
</pre></div>


<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-user-cert-renew -k userkey.pem -c usercert.pem
</pre></div>


<h3 id="osg-user-cert-revoke">osg-user-cert-revoke<a class="headerlink" href="#osg-user-cert-revoke" title="Permanent link">&para;</a></h3>
<p>Revoke a user certificate from OIM given a request ID or certificate ID. Usually the script is run when a user wants to revoke user certificate.</p>
<p>For revoking user certificate, user authentication is done and if the user is authorized to revoke the user certificate, the certificate is immediately revoked and an email notification is sent informing the user that the user certificate is revoked.</p>
<p><strong>The script:</strong></p>
<ul>
<li>Accepts a Request ID or Certificate ID from the user.</li>
<li>Authenticates user and connects to OIM to revoke the user certificate identified by the request ID or the certificate ID.</li>
</ul>
<p><strong>Inputs:</strong></p>
<ul>
<li>Private key for the user requesting host certificate revocation.</li>
<li>User certificate for the user requesting host certificate revocation.</li>
<li>Message for requesting the user certificate revocation.</li>
<li>Request ID OR the certificate ID for the user certificate to be revoked.</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Message if the revocation was successful along with the host cert request ID/certificate ID on <code>stdout</code>.</li>
<li>Error message if the revocation was unsuccessful on <code>stdout</code>.</li>
</ul>
<p>If the user's private key and certificate are not provided, the script takes the private key and user certificate from the <code>~/.globus</code> folder using the default names (<code>userkey.pem</code> and <code>usercert.pem</code>, respectively)</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-user-cert-revoke --help
<span class="go">Usage: osg-user-cert-revoke [options] &lt;Request ID&gt; &lt;message&gt;</span>
<span class="go">Usage: osg-user-cert-revoke -h/--help [for detailed explanations of options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -n, --certid          Treat the ID argument as the serial ID# for the</span>
<span class="go">                        certificate to be revoked</span>
<span class="go">  -u, --user            Certificate to be revoked is a user certificate.</span>
<span class="go">                        Redundant when using `osg-user-cert-revoke`.</span>
<span class="go">  -k PKEY, --pkey=PKEY  Specify Requestor&#39;s private key (PEM Format). If not</span>
<span class="go">                        specified, this takes the value of X509_USER_KEY or</span>
<span class="gp">                        $</span>HOME/.globus/userkey.pem
<span class="go">  -c CERT, --cert=CERT  Specify Requestor&#39;s certificate (PEM Format). If not</span>
<span class="go">                        specified, this takes the value of X509_USER_CERT or</span>
<span class="gp">                        $</span>HOME/.globus/usercert.pem
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -V, --version         Print version information and exit</span>
<span class="go">  -m REASON, --message=REASON</span>
<span class="go">                        Specify the reason for certificate revocation</span>
<span class="go">                        [deprecated]</span>
<span class="go">  -i, --id              Specify ID# of certificate to be retrieved</span>
<span class="go">                        [deprecated]</span>
</pre></div>


<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-user-cert-revoke -i <span class="m">999</span> -m <span class="s2">&quot;Testing user cert revocation&quot;</span> -k privatekeyfile -c usercertfile
</pre></div>


<h3 id="osg-cert-revoke">osg-cert-revoke<a class="headerlink" href="#osg-cert-revoke" title="Permanent link">&para;</a></h3>
<p>Revoke a host certificate from OIM given a request ID. Usually the script is run when a user wants to revoke host/service certificate.</p>
<p>For revoking host certificate, user authentication is done and if the user is authorized to revoke the host certificate, the certificate is immediately revoked and an email notification is sent informing the user that the host certificate is revoked.</p>
<p><strong>The script:</strong></p>
<ul>
<li>Accepts a request ID from the user.</li>
<li>Authenticates user and connects to OIM to revoke the host certificate identified by the request ID.</li>
</ul>
<p><strong>Inputs:</strong></p>
<ul>
<li>Private key for the user requesting host certificate revocation.</li>
<li>certificate for the user requesting host certificate revocation.</li>
<li>Message for requesting the host certificate revocation.</li>
<li>Request ID for the host certificate to be revoked.</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Message if the revocation was successful along with the host cert request ID on <code>stdout</code>.</li>
<li>Error message if the revocation was unsuccessful on <code>stdout</code>.</li>
</ul>
<p>If the user's private key and certificate are not provided, the script takes the private key and user certificate from the <code>~/.globus</code> folder using the default names (<code>userkey.pem</code> and <code>usercert.pem</code>, respectively).</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-user-cert-revoke --help
<span class="go">Usage: osg-cert-revoke [options] &lt;Request ID&gt; &lt;message&gt;</span>
<span class="go">Usage: osg-cert-revoke -h/--help [for detailed explanations of options]</span>

<span class="go">Options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -n, --certid          Treat the ID argument as the serial ID# for the</span>
<span class="go">                        certificate to be revoked</span>
<span class="go">  -u, --user            Certificate to be revoked is a user certificate.</span>
<span class="go">                        Redundant when using `osg-user-cert-revoke`.</span>
<span class="go">  -k PKEY, --pkey=PKEY  Specify Requestor&#39;s private key (PEM Format). If not</span>
<span class="go">                        specified, this takes the value of X509_USER_KEY or</span>
<span class="gp">                        $</span>HOME/.globus/userkey.pem
<span class="go">  -c CERT, --cert=CERT  Specify Requestor&#39;s certificate (PEM Format). If not</span>
<span class="go">                        specified, this takes the value of X509_USER_CERT or</span>
<span class="gp">                        $</span>HOME/.globus/usercert.pem
<span class="go">  -T, --test            Run in test mode</span>
<span class="go">  -t TIMEOUT, --timeout=TIMEOUT</span>
<span class="go">                        Specify the timeout in minutes</span>
<span class="go">  -q, --quiet           don&#39;t print status messages to stdout</span>
<span class="go">  -V, --version         Print version information and exit</span>
<span class="go">  -m REASON, --message=REASON</span>
<span class="go">                        Specify the reason for certificate revocation</span>
<span class="go">                        [deprecated]</span>
<span class="go">  -i, --id              Specify ID# of certificate to be retrieved</span>
<span class="go">                        [deprecated]</span>
</pre></div>


<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-cert-revoke -i <span class="m">999</span> -m <span class="s2">&quot;Testing host cert revocation&quot;</span> -k privatekeyfile -c usercertfile
</pre></div>


<h2 id="test-mode">Test Mode<a class="headerlink" href="#test-mode" title="Permanent link">&para;</a></h2>
<p>The scripts have two modes of execution.</p>
<p>In the normal mode of execution, the script connects to the production server and generated certificates are from default OSG CA.</p>
<p>If the user provides a <code>-T</code> parameter on the command-line, the scripts connect to the OIM-ITB server and any generated certificates are issued by the OSG test CAs. This mode is intended for testing and training. The resulting certificates are not usable in a production environment.</p>
<h2 id="current-limitations-and-bugs">Current Limitations and Bugs<a class="headerlink" href="#current-limitations-and-bugs" title="Permanent link">&para;</a></h2>
<ul>
<li>Note that Common Names (CNs) are limited to 64 characters. This is a limitation of OpenSSL and the PKI standard. For details see <a href="https://jira.opensciencegrid.org/browse/OSGPKI-252">OSGPKI-252</a>.</li>
</ul>
<h1 id="osg-ca-certificates-updater">OSG CA Certificates Updater<a class="headerlink" href="#osg-ca-certificates-updater" title="Permanent link">&para;</a></h1>
<p>This section explains the installation and use of <code>osg-ca-certs-updater</code>, a package that provides automatic updates of
CA certificates.</p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>As with all OSG software installations, there are some one-time (per host) steps to prepare in advance:</p>
<ul>
<li>Ensure the host has <a href="../../release/supported_platforms">a supported operating system</a></li>
<li>Obtain root access to the host</li>
<li>Prepare the <a href="../../common/yum">required Yum repositories</a></li>
<li>Install <a href="../../common/ca">CA certificates</a></li>
</ul>
<h2 id="install-instructions">Install instructions<a class="headerlink" href="#install-instructions" title="Permanent link">&para;</a></h2>
<p>Run the following command to install the latest version of the updater.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host#</span> yum install osg-ca-certs-updater
</pre></div>


<h2 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h2>
<h3 id="starting-and-enabling-services">Starting and Enabling Services<a class="headerlink" href="#starting-and-enabling-services" title="Permanent link">&para;</a></h3>
<p>Run the following to enable the updater. This will persist until the machine is rebooted.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host#</span> service osg-ca-certs-updater-cron start
</pre></div>


<p>Run the following to enable the updater when the machine is rebooted.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host#</span> chkconfig osg-ca-certs-updater-cron on
</pre></div>


<p>Run both commands if you wish for the service to activate immediately and remain active throughout reboots.</p>
<h3 id="stopping-and-disabling-services">Stopping and Disabling Services<a class="headerlink" href="#stopping-and-disabling-services" title="Permanent link">&para;</a></h3>
<p>Enter the following to disable the updater. This will persist until the machine is rebooted.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host#</span> service osg-ca-certs-updater-cron stop
</pre></div>


<p>Enter the following to disable the updater when the machine is rebooted.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host#</span> chkconfig osg-ca-certs-updater-cron off
</pre></div>


<p>Run both commands if you wish for the service to deactivate immediately and not get reactivated during reboots.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>While there is no configuration file, the behavior of the updater can be adjusted by command-line arguments that are specified in the <code>cron</code> entry of the service. This entry is located in the file <code>/etc/cron.d/osg-ca-certs-updater</code>. Please see the Unix manual page for <code>crontab</code> in section 5 for an explanation of the format. The manual page can be accessed by the command <code>man 5 crontab</code>. The valid command-line arguments can be listed by running <code>osg-ca-certs-updater --help</code>. Reasonable defaults have been provided, namely:</p>
<ul>
<li>Attempt an update no more often than every 23 hours. Due to the random wait (see below), having a 24-hour minimum time between updates would cause the update time to slowly slide back every day.</li>
<li>Run the script every 6 hours. We run the script more often than we update so that downtime at the wrong moment does not cause the update to be delayed for a full day.</li>
<li>Delay for a random amount of time up to 30 minutes before updating, to reduce load spikes on OSG repositories.</li>
<li>Do not warn the administrator about update failures that have happened less than 72 hours since the last successful update.</li>
<li>Log errors only.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="useful-configuration-and-log-files">Useful configuration and log files<a class="headerlink" href="#useful-configuration-and-log-files" title="Permanent link">&para;</a></h3>
<h4 id="configuration-file">Configuration file<a class="headerlink" href="#configuration-file" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th align="left">Package</th>
<th align="left">File Description</th>
<th align="left">Location</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">osg-ca-certs-updater</td>
<td align="left">Cron entry for periodically launching the updater</td>
<td align="left"><code>/etc/cron.d/osg-ca-certs-updater</code></td>
<td align="left">Command-line arguments to the updater can be specified here</td>
</tr>
<tr>
<td align="left">osg-release</td>
<td align="left">Repo definition files for production OSG repositories</td>
<td align="left"><code>/etc/yum.repos.d/osg.repo</code> or <code>/etc/yum.repos.d/osg-el6.repo</code></td>
<td align="left">Make sure these repositories are enabled and reachable from the host you are trying to update</td>
</tr>
</tbody>
</table>
<h4 id="log-files">Log files<a class="headerlink" href="#log-files" title="Permanent link">&para;</a></h4>
<p>Logging is performed to the console by default. Please see the manual for your <code>cron</code> daemon to find out how it handles console output.</p>
<p>A logfile can be specified via the <code>-l</code> / <code>--logfile</code> command-line option.</p>
<p>If logging to syslog via the <code>-s</code> / <code>--log-to-syslog</code> option, the updater will write to the <code>user</code> section of the syslog. The file <code>/etc/syslog.conf</code> determines where syslog messages are saved.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<p>Some guides on X.509 certificates:</p>
<ul>
<li>Useful commands: <a href="http://security.ncsa.illinois.edu/research/grid-howtos/usefulopenssl.html">http://security.ncsa.illinois.edu/research/grid-howtos/usefulopenssl.html</a></li>
<li>Install GSI authentication on a server: <a href="http://security.ncsa.illinois.edu/research/wssec/gsihttps/">http://security.ncsa.illinois.edu/research/wssec/gsihttps/</a></li>
<li>Certificates how-to: <a href="http://www.nordugrid.org/documents/certificate_howto.html">http://www.nordugrid.org/documents/certificate_howto.html</a></li>
</ul>
<p>Some examples about verifying the certificates:</p>
<ul>
<li><a href="http://gagravarr.org/writing/openssl-certs/others.shtml">http://gagravarr.org/writing/openssl-certs/others.shtml</a></li>
<li><a href="http://www.cyberciti.biz/faq/test-ssl-certificates-diagnosis-ssl-certificate/">http://www.cyberciti.biz/faq/test-ssl-certificates-diagnosis-ssl-certificate/</a></li>
<li><a href="http://www.cyberciti.biz/tips/debugging-ssl-communications-from-unix-shell-prompt.html">http://www.cyberciti.biz/tips/debugging-ssl-communications-from-unix-shell-prompt.html</a></li>
</ul>
<h1 id="managing-cas">Managing CAs<a class="headerlink" href="#managing-cas" title="Permanent link">&para;</a></h1>
<p>The osg-ca-manage tool provides a unified interface to manage the CA Certificate installations. This page provides the instructions on using this command. It provides status commands that allows you to list the CAs and the validity of the CAs and CRLs included in the installation. The manage commands allow you to fetch CAs and CRLs, change the distribution URL, as well as add and remove CAs from your local installation.</p>
<h2 id="syntax">Syntax<a class="headerlink" href="#syntax" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>   osg-ca-manage [global_options] command 
    global_options =
        [--verbose]
        [--force]
        [--cert-dir &lt;location&gt;]
        [--help | --usage]
        [--version]
        [--auto-refresh]

    command = [manage_command | status_command]

    status_command = [
        showCAURL |
        listCA [--pattern &lt;pattern&gt;] |
        verify [--hash &lt;CA hash&gt;  | --pattern &lt;pattern&gt;] |
        diffCAPackage |
        show [--certfile &lt;cert_file&gt; | --hash &lt;CA hash&gt;] |
        showChain [--certfile &lt;cert_file&gt; | --hash &lt;CA hash&gt;]
    ]

    manage_command = [
        setupCA --location &lt;root|PATH&gt; [--url &lt;osg|igtf|URL&gt; --no-update --force] |
        refreshCA |
        fetchCRL |
        setCAURL [--url &lt;osg|igtf|URL&gt;] |
        add [--cadir &lt;localdir&gt; | --caname &lt;CA&gt;]
        remove [--cadir &lt;localdir&gt; | --caname &lt;CA&gt;]
    ]
</pre></div>


<h3 id="explanation-of-global-options">Explanation of global options<a class="headerlink" href="#explanation-of-global-options" title="Permanent link">&para;</a></h3>
<p>Zero or more of these options may be used during an execution of ca_manage.</p>
<ol>
<li><code>--verbose</code> Provides you with more information depending on the command context.</li>
<li><code>--force</code> Forces the command to run ignoring any checks/warnings. The actual effect is context dependent, and this behavior is noted in the command details below.</li>
<li><code>--cert-dir &lt;location&gt;</code> This location specifies the path CA directory. If this option is not specified then the command will look for <code>$X509_CERT_DIR</code> followed by <code>/etc/grid-security/certificates</code>. If none of these directories can be found, the command will exit with an error.</li>
<li><code>--auto-refresh</code> This option will indicate if this permissible to fetch CAs and CRLs as deemed necessary by this tool. For example at the end of an addCA/removeCA it would be advisable to refresh the CA list and the corresponding CRLs. Default is <strong>not</strong> to refresh, unless the admin requests it by specifying this option.</li>
<li><code>--version</code> Prints the version of the <code>osg-ca-manage</code> tool.</li>
<li><code>--help | --usage</code> Print usage information. Show a brief explanatory text for using osg-ca-manage.</li>
</ol>
<h3 id="explanation-of-commands">Explanation of commands<a class="headerlink" href="#explanation-of-commands" title="Permanent link">&para;</a></h3>
<p>Exactly one command is to be specified during an execution of osg-ca-manage</p>
<h4 id="status-commands">Status commands<a class="headerlink" href="#status-commands" title="Permanent link">&para;</a></h4>
<ol>
<li><code>showCAURL</code> This will print out the distribution location specified in the config file. This command will read osg-update-certs.conf and output cacerts_url.</li>
<li><code>listCA [--pattern &lt;pattern&gt;]</code> This command will use openssl x509 command on the files in the --dir to provide hash, the subject and whether a CA is IGTF or TeraGrid accredited and distribution package which was used to download CAs into the directory. --verbose option will provide additional information like issuer (of CA) and all associated dates (CA cert issuance date, and CRL issuance date, and expiry dates). The command will look for CA files in the -certDir. The <code>&lt;pattern&gt;</code> specified in the option will be matched, using perl regex, against the subject field of the certificate (but we might also expand it include issuer if needed) and all CAs are listed if no pattern is given.</li>
<li><code>verify [--hash &lt;CA_hash&gt; | --pattern &lt;pattern&gt;]</code> The verify command will check all CAs (or if specified only the <code>&lt;CA_hash&gt;</code>) in the <code>&lt;certDir&gt;</code> directory, to see if any CA/CRL have expired or are about to do so. If any expired CA/CRL are found, an error is issued along with the hash, date when CA cert/CRL expired. A warning is issued if either the CA cert or CRL is about the expire within the next 24 Hrs. The --verbose option provides the CA Name, date the CA certs and CRL files are created (by the CA), and when they will expire. In addition to hash value we will also consider providing an option of verify using <code>&lt;pattern&gt;</code> </li>
<li><code>diffCAPackage</code> This command will compare the hash of certificates included in the certificate directory against the latest OSG distribution (based on your <code>cacerts_url</code>) and outputs the difference. </li>
<li><code>show [--certfile &lt;cert_file&gt; | --hash &lt;CA_hash&gt;]</code> This command will essentially provide a condensed output of openssl x509 command. --verbose option will provide the full output. If --hash option is used we will look for the <code>&lt;CA_hash&gt;.o</code> file in the <code>&lt;certDir&gt;</code>. The --certfile option can also take in a user proxy. </li>
<li><code>showChain [--certfile &lt;cert_file&gt; | --hash &lt;CA_hash&gt;]</code> This command will output the trust chain of the certificate. <code>&lt;certDir&gt;</code> will be used as the directory in which search for ancestor certs will be conducted. This command can also be used to trace the trust chain of a user proxy.</li>
</ol>
<h4 id="manage-commands">Manage commands<a class="headerlink" href="#manage-commands" title="Permanent link">&para;</a></h4>
<ol>
<li><code>setupCA --location &lt;root|PATH&gt; [--url &lt;osg|igtf|URL&gt; --no-update --force]</code> This command is used for the inital setup of the CA package. The CA package can be setup to download CAs from any URL. Keywords are provided for various distributions. For the location to specify, keywords are provided to install into 'root' (/etc/grid-security). A --no-update option is available. Setting this flag instructs just setup the symlinks only and not to run configure osg-update-certs to be run automatically. This option is for installations that will not manage their own certificates, but will rely on updates through another method (such as RPM, or using osg-update-certs from a different OSG installation). A common use case for this is to have worker-node installations rely on the CA certificates being available on an NFS share, and the updating will happen on a single node.</li>
<li><code>refreshCA</code> This command run osg-update-certs to check for a new version of the CA distribution. If you already have the latest version, but wish to force an update anyways, use the --force option. 1.<code>fetchCRL</code> It retrieves CRLs for all CAs within the directory. This will involve invoking fetch-crl, with appropriate arguments. NOTE: If the OSG's 's fetch-crl service has not been enabled, then this command will not execute. This is a safety mechanism to prevent crls from being downloaded using this tool if they are not scheduled to be updated.</li>
<li><code>setCAURL [--url &lt;osg|igtf|URL&gt;]</code> This command sets the location from where the CA files. This command will modify vdt-update-certs.conf and set the cacerts_url as <code>&lt;URL_location&gt;</code>. Only if --auto-refresh is specified both CA and CRLs are refreshed once the URL change has been made. The distribution <code>&lt;URL_location&gt;</code> will be required to conform to the CA distribution format (e.g. similar to <a href="https://repo.grid.iu.edu/pacman/cadist/ca-certs-version-igtf-new">https://repo.grid.iu.edu/pacman/cadist/ca-certs-version-igtf-new</a>). If the <code>&lt;URL_location&gt;</code> cannot be reached or if it is valid syntactically (i.e. does not conform to the format requirements) a warning will be issues and no changes will be made. The --force option can be used to force a change ignoring the warning. If URL location is left unspecified the <code>&lt;URL_location&gt;</code> will be set to OSG default. We define keywords for OSG, IGTF as shortcuts for OSG wide well-known CA URL_locations.</li>
<li><code>add [--cadir &lt;localdir&gt; | --caname &lt;CA&gt;]</code> The --hash argument is required. If --dir is not specified we will assume that the user wants to include a CA he has previously excluded and will remove the corresponding exclude lines from the config. If <code>&lt;CA_hash&gt;</code> is not known to us or it is already included we will provide appropriate error/warning information. In the common case this command will add include lines for <code>&lt;local_dir&gt;</code>/<code>&lt;CA_hash&gt;</code>.0, into the vdt-update-certs.conf file. Lastly the command will invoke functions refresh the CAs and fetch CRLs. This command will also do some preliminary error checks, e.g. make sure that “.0”, “.crl_url”, “.signing_policy” files exist and that --dir is different than --certDir.</li>
<li><code>remove [--cadir &lt;localdir&gt; | --caname &lt;CA&gt;]</code> This command will be complementary to add and would either add an exclude or remove an include depending on the scenario. This command will also refresh CA and CRLs. vdt-update-certs do the job of removing cert files, we will still do the preliminary error checks to make sure that the certs that are being removed are included in the first place. For both addCA and removeCA, new CAs will be included/removed and CRLs will be refreshed only if --auto-refresh is set.</li>
</ol>
<h3 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These commands will not work if of the osg-ca-certs (or igtf-ca-certs) RPM packages are installed.</p>
</div>
<h4 id="install-a-certificate-authority-package">Install a Certificate Authority Package<a class="headerlink" href="#install-a-certificate-authority-package" title="Permanent link">&para;</a></h4>
<p>Before you proceed to install a Certificate Authority Package you should decide which of the available packages to install.</p>
<ul>
<li><code>osg</code>, the package recommended to be used by production resources on the OSG. It is based on the CA distribution from the IGTF, but it may differ slightly as decided by the <a href="https://opensciencegrid.github.io/security">Security Team</a>. </li>
<li><code>igtf</code>, the package is a redistribution of the unchanged CA distribution from the IGTF</li>
<li><code>url</code> a package provided at a given URL</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If in doubt, please consult the policies of your home institution and get in contact with the <a href="https://opensciencegrid.github.io/security">Security Team</a>.</p>
</div>
<p>Next decide at what location to install the Certificate Authority Package:</p>
<ol>
<li>on the <code>root</code> file system in a system directory <code>/etc/grid-security/certificates</code></li>
<li>in a <code>custom</code> directory that can also be shared</li>
</ol>
<h5 id="setup-the-ca-certificates">Setup the CA Certificates<a class="headerlink" href="#setup-the-ca-certificates" title="Permanent link">&para;</a></h5>
<p>The Certificate Authority Package is preferably be used by grid users without root privileges <em>or</em> if the CA certificates will not be shared by other installations on the same host.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> osg-ca-manage setupca --location <span style="color:red">root</span> --url osg
<span class="go">Setting CA Certificates for at &#39;/etc/grid-security/certificates&#39;</span>

<span class="go">Setup completed successfully.</span>
</pre></div>


<p>After a successful installation the certificates will be installed in (<code>/etc/grid-security/certificates</code> in this example). Typically to write into this default location you will need root privileges.</p>
<p>If you need to need to install it with out root privileges use</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> osg-ca-manage setupca --location <span style="color:red"><span class="nv">$HOME</span>/certificates</span> --url osg
<span class="go">Setting CA Certificates for at &#39;$HOME/certificates&#39;</span>

<span class="go">Setup completed successfully.</span>
</pre></div>


<h4 id="addingremoving-a-directory-of-local-cas">Adding/Removing a directory of local CAs<a class="headerlink" href="#addingremoving-a-directory-of-local-cas" title="Permanent link">&para;</a></h4>
<h5 id="adding">Adding<a class="headerlink" href="#adding" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span>osg-ca-manage add --cadir /etc/grid-security/localca
<span class="go">NOTE:</span>
<span class="go">    You did not specify the --auto-refresh flag.</span>
<span class="go">    So the changes made to the configuration will not be reflected till the next time</span>
<span class="go">    when CAs and CRLs are updated respectively by osg-update-certs and fetch-crl running from cron.</span>
<span class="go">    Run `osg-ca-manage refreshCA` and `osg-ca-manage fetchCRL` to commit your changes immediately.</span>
</pre></div>


<p>Here is the resulting file after add</p>
<div class="codehilite"><pre><span></span>##cat /etc/osg/osg-update-certs.conf
# Configuration file for osg-update-certs

# This file has been regenerated by osg-ca-manage, which removes most
# comments.  You can still manually modify it, any manual change will
# be preserved if osg-ca-manage is used again.

## The parent location certificates will be installed at.
install_dir = /etc/grid-security

## cacerts_url is the URL of your certificate distribution
cacerts_url = https://repo.grid.iu.edu/pacman/cadist/ca-certs-version-igtf-new

## log specifies where logging output will go
log = /var/log/osg-update-certs.log

## include specifies files (full pathnames) that should be copied
## into the certificates installation after an update has occured.
include=/etc/grid-security/localca/*

## exclude_ca specifies a CA (not full pathnames, but just the hash
## of the CA you want to exclude) that should be removed from the
## certificates installation after an update has occured.

debug = 0
</pre></div>


<h5 id="removing">Removing<a class="headerlink" href="#removing" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span>osg-ca-manage remove --cadir /etc/grid-security/localca
<span class="go">NOTE:</span>
<span class="go">    You did not specify the --auto-refresh flag.</span>
<span class="go">    So the changes made to the configuration will not be reflected till the next time</span>
<span class="go">    when CAs and CRLs are updated respectively by osg-update-certs and fetch-crl running from cron.</span>
<span class="go">    Run `osg-ca-manage refreshCA` and `osg-ca-manage fetchCRL` to commit your changes immediately.</span>
</pre></div>


<h4 id="removingadding-a-particular-ca-included-in-osg-ca-package">Removing/Adding a particular CA included in OSG CA package<a class="headerlink" href="#removingadding-a-particular-ca-included-in-osg-ca-package" title="Permanent link">&para;</a></h4>
<h5 id="removing_1">Removing<a class="headerlink" href="#removing_1" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span>osg-ca-manage remove --caname ce33db76
<span class="go">Symlink detected for hash: We have determided that the hash value you entered belong to the CA &#39;IRAN-GRID.pem&#39;. If you wish to add this CA back you will have to use this name is the parameter.</span>
<span class="go">NOTE:</span>
<span class="go">    You did not specify the --auto-refresh flag.</span>
<span class="go">    So the changes made to the configuration will not be reflected till the next time</span>
<span class="go">    when CAs and CRLs are updated respectively by osg-update-certs and fetch-crl running from cron.</span>
<span class="go">    Run `osg-ca-manage refreshCA` and `osg-ca-manage fetchCRL` to commit your changes immediately.</span>
</pre></div>


<p>The resulting config file after the remove is as follows</p>
<div class="codehilite"><pre><span></span>##cat /etc/osg/osg-update-certs.conf
# Configuration file for osg-update-certs

# This file has been regenerated by osg-ca-manage, which removes most
# comments.  You can still manually modify it, any manual change will
# be preserved if osg-ca-manage is used again.

## The parent location certificates will be installed at.
install_dir = /etc/grid-security

## cacerts_url is the URL of your certificate distribution
cacerts_url = https://repo.grid.iu.edu/pacman/cadist/ca-certs-version-igtf-new

## log specifies where logging output will go
log = /var/log/osg-update-certs.log

## include specifies files (full pathnames) that should be copied
## into the certificates installation after an update has occured.

## exclude_ca specifies a CA (not full pathnames, but just the hash
## of the CA you want to exclude) that should be removed from the
## certificates installation after an update has occured.
exclude_ca = IRAN-GRID

debug = 0
</pre></div>


<h5 id="adding-back-the-removed-ca">Adding back the removed CA<a class="headerlink" href="#adding-back-the-removed-ca" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span>osg-ca-manage add --caname IRAN-GRID
<span class="go">NOTE:</span>
<span class="go">    You did not specify the --auto-refresh flag.</span>
<span class="go">    So the changes made to the configuration will not be reflected till the next time</span>
<span class="go">    when CAs and CRLs are updated respectively by osg-update-certs and fetch-crl running from cron.</span>
<span class="go">    Run `osg-ca-manage refreshCA` and `osg-ca-manage fetchCRL` to commit your changes immediately.</span>
</pre></div>


<h4 id="inspect-installed-ca-certificates">Inspect Installed CA Certificates<a class="headerlink" href="#inspect-installed-ca-certificates" title="Permanent link">&para;</a></h4>
<p>You can inspect the list of CA Certificates that have been installed:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> osg-ca-manage listCA
<span class="go">Hash=09ff08b7; Subject= /C=FR/O=CNRS/CN=CNRS2-Projets; Issuer= /C=FR/O=CNRS/CN=CNRS2; Accreditation=Unknown; Status=https://repo.grid.iu.edu/pacman/cadist/ca-certs-version</span>
<span class="go">Hash=0a12b607; Subject= /DC=org/DC=ugrid/CN=UGRID CA; Issuer= /DC=org/DC=ugrid/CN=UGRID CA; Accreditation=Unknown; Status=https://repo.grid.iu.edu/pacman/cadist/ca-certs-version</span>
<span class="go">[...]</span>
</pre></div>


<p>Any certificate issued by any of the Certificate Authorities listed will be trusted. If in doubt please contact the <a href="https://opensciencegrid.github.io/security">OSG Security Team</a> and review the policies of your home institution.</p>
<h2 id="troubleshooting_1">Troubleshooting<a class="headerlink" href="#troubleshooting_1" title="Permanent link">&para;</a></h2>
<h3 id="useful-configuration-and-log-files_1">Useful configuration and log files<a class="headerlink" href="#useful-configuration-and-log-files_1" title="Permanent link">&para;</a></h3>
<p>Logs and configuration:</p>
<table>
<thead>
<tr>
<th align="left">File Description</th>
<th align="left">Location</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Configuration File for osg-update-certs</td>
<td align="left"><code>/etc/osg/osg-update-certs.conf</code></td>
<td align="left">This file may be edited by hand, though it is recommended to use osg-ca-manage to set configuration parameters.</td>
</tr>
<tr>
<td align="left">Log file of osg-update-certs</td>
<td align="left"><code>/var/log/osg-update-certs.log</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Stdout of osg-update-certs</td>
<td align="left"><code>/var/log/osg-ca-certs-status.system.out</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Stdout of osg-ca-manage</td>
<td align="left"><code>/var/log/osg-ca-manage.system.out</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Stdout of initial CA setup</td>
<td align="left"><code>/var/log/osg-setup-ca-certificates.system.out</code></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2 id="references_1">References<a class="headerlink" href="#references_1" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../common/ca">Installing the Certificate Authorities Certificates and the related RPMs</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../common/install-best-practices/" class="btn btn-neutral float-right" title="Install Best Practices">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../user-certs/" class="btn btn-neutral" title="User Certificates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/docs-itb/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../user-certs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../common/install-best-practices/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
